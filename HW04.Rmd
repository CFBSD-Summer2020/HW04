---
title: "Exploring Gun Deaths in America"
output: github_document
---

## Objectives
* To explore gun death data curated by FiveThirtyEight - [original data available here] - (https://github.com/fivethirtyeight/guns-data) by
    * Month
    * Intent
    * Age and sex
    * Education
    * Season
    * Intent by race
    * Police-relatedness 

## Read in the data

The gun_deaths.csv is provided in the repository. 
```{r load-data, message=FALSE, warning=FALSE}
library(tidyverse)    # load tidyverse packages, including ggplot2
library(knitr)
library(devtools)

# read in the data
gun_data <- read.csv("gun_deaths.csv")
```

## Generating a data frame that summarizes the number of gun deaths per month and printing using `kable()`. 

Knitr is part of the knitr package. Allows you to change column names and add captions and make pretty tables in your knitted document. Hint: set the argument format = "markdown"


```{r month, warning=FALSE}
monthly_gun_data <- gun_data %>%
    select(month) %>%
    mutate(month = factor(month.abb[month], 
                          levels = c("Jan", "Feb","Mar", "Apr", "May", 
                                     "Jun", "Jul", "Aug","Sep", "Oct", "Nov", "Dec"))) %>%
    group_by(month) %>%
    count()

kable(monthly_gun_data, format = "markdown",
      col.names = c("Month", "Total Deaths"),
      caption = "Total Gun Deaths from 2012-2014 by Month")
```


### Generating a bar chart with human-readable labels on the x-axis. That is, each month should be labeled "Jan", "Feb", "Mar" (full or abbreviated month names are fine), not `1`, `2`, `3`.

```{r month_chart}
# creating a theme to use for all further plots
theme04 <- theme(plot.subtitle = element_text (hjust = 0.5),
            plot.title = element_text(size = 15, hjust = 0.5),
            axis.line = element_line(color = "grey60", size = 0.3),
            axis.text.x = element_text(size = 7),
            axis.title.x= element_text(vjust = -1),
            panel.background = element_blank()) 

# generating a barplot to show the gun deaths per month
ggplot(monthly_gun_data, mapping = aes(x = month, y = n)) +
    geom_col(fill = "skyblue") +
    geom_text(aes(label = n), vjust = -0.5, size = 3, color = "grey40") +

# making the plot prettier
     labs(title = "US Gun Deaths by Month (2012-2014)", 
       x = "Month", 
       y = "Number of Deaths",
       caption = "Source: FiveThirtyEight") +
# adding theme
    theme04
```

## Generating a bar chart that identifies the number of gun deaths associated with each type of intent cause of death. The bars should be sorted from highest to lowest values.

```{r intent}
gun_data %>%
# counting observations with each "intent" type
    count(intent) %>%
# generating a graph displaying the counts
ggplot(mapping = aes(reorder(intent, -n), n)) +
    geom_col(fill = "skyblue") + 
# adding data labels because of large range 
    geom_text(aes(label = n), vjust = -0.5, size = 3, color = "grey40") +
# making the graph nicer
    labs(title = "US Gun Deaths by Intent (2012-2014)", 
       x = "Intent of Incident", 
       y = "Number of Deaths",
       caption = "Source: FiveThirtyEight") +
# adding theme
    theme04
```

## Generating a boxplot visualizing the age of gun death victims, by sex. Print the average age of female gun death victims.

```{r age_&_sex}
#removing data points for which age is not available
data_with_sex <- gun_data %>%
    filter(age != "Not Available") %>%
    mutate(age = as.numeric(age))

# generating a boxplot visualizing the data
ggplot(data_with_sex, mapping = aes(x = sex, y = age)) +
    geom_boxplot(fill = "skyblue") +

# adding labels
     labs(title = "Ages of Gun Death Victims", 
          subtitle = "Age Distributions of US Gun Death Victims, by Sex, in the United States from 2012 to 2014",
          x = "Sex", 
          y = "Age (Years)",
          caption = "Source: FiveThirtyEight") + 
    scale_x_discrete(breaks=c("F", "M"),
                      labels=c("Female", "Male")) +
    
# adding a theme
    theme04

# calculating the mean age of female gun death victims
data_with_sex %>%
    filter(sex == "F") %>%
    summarize(average_female_age = mean(age))
```

**The average age of the female gun death victims in this dataset is 44.15 years.**

## How many white males with at least a high school education were killed by guns in 2012?

```{r education}
gun_data %>%
# filtering for all of the specified criteria
    filter(year == 2012, 
           race == "White", 
           education != "Less than HS",
           sex == "M") %>%
# counting the remaining observations, which will determine the answer
    count()
```
**In 2012, 15,484 white males with at least a high school education were killed by guns in 2012.**

## Which season of the year has the most gun deaths?

Assume that:

* Winter = January-March
* Spring = April-June
* Summer = July-September
* Fall = October-December

```{r season}

```


# These are more open ended questions from here on out, you could look at making multiple summaries or types of plots. 

### Are whites who are killed by guns more likely to die because of suicide or homicide? How does this compare to blacks and hispanics?

```{r race}
# creating a new datafram that includes counts for intent by race, filters for the 3 requested races, and only includes homicides and suicides
race_intent_data <- gun_data %>%
    select(race, intent) %>%
    filter(race %in% c("White", "Black", "Hispanic"),
           intent %in% c("Suicide", "Homicide")) %>%
    group_by(race, intent) %>%
    count() %>%
    ungroup()
```

(hint maybe looking at percentages would be good)
```{r race_2}
# generate a stacked barplot to visualize intent by race
ggplot(race_intent_data, mapping = aes(x = race, y = n, fill = intent)) + 
    geom_col(position = "fill") +

# adding labels for legibility 
    labs(title = "Homicide and Suicide Gun Deaths by Race", 
          subtitle = "Proportion of US Gun Deaths, by Race, from Homicide vs. Suicide from 2012-2014",
          x = "Race", 
          y = "Proportion of Total Deaths",
          caption = "Source: FiveThirtyEight",
          fill = "Intent") + 

# changing colors
    scale_fill_manual(values = c("skyblue", "palevioletred2")) +

# adding a theme
    theme04
```
**According to this graph, whites killed by guns are more likely to die by suicide (~85%) than by homicide. Blacks and Hispanics, on the other hand, are more likely to die by homicide (~85% and ~70%, respectively).**

### Are police-involved gun deaths significantly different from other gun deaths? Assess the relationship between police involvement and age, police involvement and race, and the intersection of all three variables.

```{r police}
# cleaning up the dataset to contain only the needed variables, removing any instances of age being unavailable
police_data <- gun_data %>%
    select(police, age, race) %>%
    filter(age != "Not Available") %>%
    mutate(age = as.numeric(age)) %>%
    group_by(police)

# changing one variable to allow for cleaner labeling
police_data$race <- gsub(pattern = "Not Availabletive American/Not Availabletive Alaskan", 
     replacement = "Not Available",
     x = police_data$race)

# creating a boxplot to visualize the age distributions in each case
ggplot(police_data, mapping = aes(x = factor(police), y = age)) +
    geom_boxplot(fill = "skyblue", outlier.shape = NA) +
    
# adding labels
     labs(title = "Ages of Gun Death Victims by Police Involvement", 
          subtitle = "Age Distributions of US Gun Death Victims, by Police Involvement, \n in the United States from 2012 to 2014",
          x = "Police Involvement", 
          y = "Age (Years)",
          caption = "Source: FiveThirtyEight") + 
    scale_x_discrete(breaks=c("0", "1"),
                      labels=c("Uninvolved", "Involved")) +
    
# adding a theme
    theme04

```

Think about performing stats such as a t.test to see if differences you are plotting are statistically significant

```{r stats?}
# creating two seperate datasets basd on police involvement
age_police_uninvolved <- police_data %>%
    filter(police == 0) 
age_police_involved <- police_data %>%
    filter(police == 1) 

# use new datasets to conduct t test
t.test(age_police_uninvolved$age, age_police_involved$age)
```
**The t-test suggests that the difference in age is statistically significant.**

```{r police_2}
# manipulating dataset to calculate percentage of instances (for each race) with police involvement 
race_and_police <- police_data %>%
    group_by(race, police) %>%
    count(police) %>%
    ungroup() %>%
    group_by(race) %>%
    mutate(total = sum(n)) %>%
    filter(police == 1) %>%
    mutate(percentage_involved = n/total *100)

# generate a column graph to evaluate the rates of police involvement in each race
ggplot(race_and_police, mapping = aes(x = reorder(race, -percentage_involved),  y = percentage_involved)) + 
    geom_col(fill = "skyblue") +

# adding labels for legibility 
    labs(title = "Police Involvement in Gun Deaths, by Race", 
          subtitle = "Percentage of US Gun Deaths, by Race, with Police Involvement from 2012-2014",
          x = "Race", 
          y = "Percentage of Gun Death Instances with Police Involvement",
          caption = "Source: FiveThirtyEight") + 
    
# adding a theme
    theme04
```


Finally, all together now:
```{r police_3}
# creating a boxplot to visualize the age distributions in each case, faceted by race
ggplot(police_data, mapping = aes(x = factor(police), y = age)) +
    geom_boxplot(fill = "skyblue", outlier.shape = NA) +
    facet_wrap(~race, nrow=1) +
    
# adding labels
     labs(title = "Ages of Gun Death Victims by Police Involvement and Race", 
          subtitle = "Age Distributions of US Gun Death Victims, \n by Police Involvement and Race, in the United States from 2012 to 2014",
          x = "Police Involvement", 
          y = "Age (Years)",
          caption = "Source: FiveThirtyEight") + 
    scale_x_discrete(breaks=c("0", "1"),
                      labels=c("Uninvolved", "Involved")) +
    
# adding a theme
    theme04
```


## Session info

```{r}
# always good to have this for reproducibility purposes
devtools::session_info()
```

